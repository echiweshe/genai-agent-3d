# SVG to 3D Conversion: Blender Integration Testing Guide

## Overview

The SVG to 3D conversion component is a critical part of the SVG to Video pipeline. This guide provides instructions for testing and enhancing the Blender integration to ensure SVG diagrams are properly converted to 3D models.

## Prerequisites

1. **Blender Installation**
   - Install Blender 3.0+ from [blender.org](https://www.blender.org/download/)
   - Ensure Blender is accessible from the command line
   - Add Blender to your PATH or set `BLENDER_PATH` in your `.env` file:
     ```
     BLENDER_PATH=C:\Program Files\Blender Foundation\Blender 3.3\blender.exe
     ```

2. **Test SVGs**
   - Use SVGs generated by the SVG generation component
   - Prepare test SVGs of various types:
     - Flowcharts
     - Network diagrams
     - Sequential diagrams
     - Complex diagrams with multiple elements

## Testing the SVG to 3D Conversion

### 1. Manual Testing with Blender

```powershell
# Test the Blender script directly 
blender --background --python genai_agent/scripts/svg_to_3d_blender.py -- --svg outputs/test_diagram.svg --output outputs/test_model.blend --extrude 0.1 --scale 1.0
```

Verify that:
- The script runs without errors
- The output .blend file is created
- The .blend file contains 3D objects that match the SVG elements

### 2. Testing Through the CLI

```powershell
.\run_svg_cli.bat convert outputs/test_diagram.svg outputs/test_video.mp4
```

Check for:
- Successful execution of each pipeline stage
- Proper error handling if Blender is not installed
- Appropriate logging of the conversion process

### 3. Testing Through the API

1. Generate an SVG using the web interface or API
2. Submit the SVG for conversion using the "Convert to Video" button
3. Monitor the task status endpoint for progress updates
4. Verify the video output is created correctly

## Common Issues and Solutions

### Blender Not Found

**Symptoms**:
- Error messages about missing Blender executable
- Pipeline fails at the SVG to 3D conversion stage

**Solutions**:
1. Verify Blender is installed
2. Add Blender to your system PATH
3. Specify the full path to Blender in your `.env` file
4. Check if the script is using the correct environment variable

### SVG Import Failures

**Symptoms**:
- Blender script runs but doesn't create 3D objects
- Error messages about SVG parsing

**Solutions**:
1. Verify the SVG is valid (try opening it in a browser)
2. Check for unsupported SVG features
3. Add better error handling in the import script
4. Pre-process complex SVGs to simplify them

### Memory Issues

**Symptoms**:
- Blender crashes during conversion of complex SVGs
- Out of memory errors

**Solutions**:
1. Limit the complexity of input SVGs
2. Modify the script to process SVG elements in batches
3. Increase the memory allocation for Blender if possible
4. Add a complexity check before processing

## Enhancement Priorities

### 1. Improve SVG Element Handling
- Better support for text elements
- Proper handling of gradients and patterns
- Support for embedded images
- Improved handling of complex paths

### 2. 3D Model Optimization
- Reduce polygon count for better performance
- Implement level-of-detail for complex models
- Add options for mesh simplification
- Optimize material assignments

### 3. Better Error Handling
- Add detailed error reporting
- Implement recovery mechanisms for partial failures
- Validate SVG before processing
- Create fallback options for unsupported features

### 4. UI Enhancements
- Add preview of 3D model before animation
- Provide options for extrusion depth
- Allow manual adjustment of object positioning
- Add material customization options

## API Reference

### Convert SVG Endpoint

**POST** `/api/svg-to-video/convert-svg`

**Parameters**:
- `svg_file`: SVG file to convert (multipart/form-data)
- `animation_type`: Animation type (standard, flowchart, network)
- `quality`: Rendering quality (low, medium, high)

**Response**:
```json
{
  "task_id": "task-a5eda75fdff8ef58",
  "status": "processing"
}
```

### Task Status Endpoint

**GET** `/api/svg-to-video/task/{task_id}`

**Response**:
```json
{
  "task_id": "task-a5eda75fdff8ef58",
  "status": "completed",
  "progress": 100,
  "result": "outputs/video_file.mp4",
  "error": null
}
```

## Development Roadmap

1. **Phase 1**: Basic SVG to 3D conversion with simple extrusion
2. **Phase 2**: Improved element handling and positioning
3. **Phase 3**: Advanced materials and lighting
4. **Phase 4**: Performance optimization and scalability

## Conclusion

The SVG to 3D conversion is the bridge between the 2D diagram and the final animated video. Getting this component working reliably is crucial for the success of the entire pipeline. Focus on thorough testing and incremental improvements to ensure the best results.